# ANPåº”ç”¨å¿«é€Ÿå…¥é—¨ç¤ºä¾‹

## ğŸ¯ ç›®æ ‡

é€šè¿‡å®é™…ç¤ºä¾‹ï¼Œè®©å¼€å‘è€…åœ¨15åˆ†é’Ÿå†…æŒæ¡ANPåº”ç”¨å¼€å‘çš„æ ¸å¿ƒæ¦‚å¿µå’ŒåŸºæœ¬æ“ä½œã€‚

---

## ğŸ“‹ ç¤ºä¾‹1: Hello World Agent

### åˆ›å»ºæœ€ç®€å•çš„Agent

```python
# hello_agent.py
import asyncio
import logging
from anp_runtime.agent_decorator import agent_class, class_api
from anp_foundation.config import UnifiedConfig, set_global_config
from anp_foundation.utils.log_base import setup_logging
from anp_server.baseline.anp_server_baseline import ANP_Server

# é…ç½®åˆå§‹åŒ–
config = UnifiedConfig(config_file='unified_config_framework_demo.yaml')
set_global_config(config)
setup_logging()
logger = logging.getLogger(__name__)


@agent_class(
    name="Hello World Agent",
    description="æœ€ç®€å•çš„é—®å€™Agent",
    did="did:wba:localhost%3A9527:wba:user:27c0b1d11180f973",
    shared=False
)
class HelloAgent:
    @class_api("/hello", auto_wrap=True)
    async def hello_api(self, name: str = "ä¸–ç•Œ"):
        """é—®å€™API"""
        return {"message": f"ä½ å¥½, {name}!", "timestamp": "2024-01-15"}

    @class_api("/status")
    async def status_api(self, request_data, request):
        """çŠ¶æ€æ£€æŸ¥API"""
        return {
            "agent_name": "Hello World Agent",
            "status": "è¿è¡Œä¸­",
            "version": "1.0.0"
        }


async def main():
    # åˆ›å»ºAgentå®ä¾‹
    agent = HelloAgent()
    logger.info(f"âœ… Agent '{agent.agent.name}' åˆ›å»ºæˆåŠŸ!")

    # å¯åŠ¨æœåŠ¡å™¨
    server = ANP_Server()
    logger.info("ğŸš€ å¯åŠ¨æœåŠ¡å™¨...")
    server.start_server()

    logger.info("ğŸ”¥ æœåŠ¡å™¨è¿è¡Œä¸­ï¼ŒæŒ‰Ctrl+Cåœæ­¢")
    try:
        while True:
            await asyncio.sleep(1)
    except KeyboardInterrupt:
        logger.info("ğŸ‘‹ æœåŠ¡å™¨åœæ­¢")


if __name__ == "__main__":
    asyncio.run(main())
```

### è¿è¡Œå’Œæµ‹è¯•

```bash
# 1. è¿è¡ŒAgent
python hello_agent.py

# 2. æµ‹è¯•API
curl -X POST http://localhost:9527/agent/api/did:wba:localhost%3A9527:wba:user:27c0b1d11180f973/hello \
  -H "Content-Type: application/json" \
  -d '{"params": {"name": "å¼€å‘è€…"}}'

# å“åº”: {"message": "ä½ å¥½, å¼€å‘è€…!", "timestamp": "2024-01-15"}

# 3. æµ‹è¯•çŠ¶æ€API
curl -X POST http://localhost:9527/agent/api/did:wba:localhost%3A9527:wba:user:27c0b1d11180f973/status

# å“åº”: {"agent_name": "Hello World Agent", "status": "è¿è¡Œä¸­", "version": "1.0.0"}
```

---

## ğŸ“‹ ç¤ºä¾‹2: è®¡ç®—å™¨Agent

### åŠŸèƒ½å®Œæ•´çš„è®¡ç®—å™¨

```python
# calculator_agent.py
import asyncio
import logging
from anp_runtime.agent_decorator import agent_class, class_api, class_message_handler
from anp_foundation.config import UnifiedConfig, set_global_config
from anp_foundation.utils.log_base import setup_logging
from anp_server.baseline.anp_server_baseline import ANP_Server

# é…ç½®åˆå§‹åŒ–
config = UnifiedConfig(config_file='unified_config_framework_demo.yaml')
set_global_config(config)
setup_logging()
logger = logging.getLogger(__name__)


@agent_class(
    name="æ™ºèƒ½è®¡ç®—å™¨",
    description="æä¾›åŸºæœ¬æ•°å­¦è®¡ç®—åŠŸèƒ½",
    did="did:wba:localhost%3A9527:wba:user:27c0b1d11180f973",
    shared=False
)
class CalculatorAgent:
    def __init__(self):
        self.calculation_history = []

    @class_api("/add", auto_wrap=True)
    async def add_api(self, a: float, b: float):
        """åŠ æ³•è®¡ç®—"""
        result = a + b
        self.calculation_history.append(f"{a} + {b} = {result}")
        logger.info(f"è®¡ç®—: {a} + {b} = {result}")
        return {
            "result": result,
            "operation": "addition",
            "inputs": [a, b],
            "formula": f"{a} + {b} = {result}"
        }

    @class_api("/subtract", auto_wrap=True)
    async def subtract_api(self, a: float, b: float):
        """å‡æ³•è®¡ç®—"""
        result = a - b
        self.calculation_history.append(f"{a} - {b} = {result}")
        return {
            "result": result,
            "operation": "subtraction",
            "inputs": [a, b],
            "formula": f"{a} - {b} = {result}"
        }

    @class_api("/multiply", auto_wrap=True)
    async def multiply_api(self, a: float, b: float):
        """ä¹˜æ³•è®¡ç®—"""
        result = a * b
        self.calculation_history.append(f"{a} Ã— {b} = {result}")
        return {
            "result": result,
            "operation": "multiplication",
            "inputs": [a, b],
            "formula": f"{a} Ã— {b} = {result}"
        }

    @class_api("/divide", auto_wrap=True)
    async def divide_api(self, a: float, b: float):
        """é™¤æ³•è®¡ç®—"""
        if b == 0:
            return {
                "error": "é™¤æ•°ä¸èƒ½ä¸ºé›¶",
                "operation": "division",
                "inputs": [a, b]
            }

        result = a / b
        self.calculation_history.append(f"{a} Ã· {b} = {result}")
        return {
            "result": result,
            "operation": "division",
            "inputs": [a, b],
            "formula": f"{a} Ã· {b} = {result}"
        }

    @class_api("/power", auto_wrap=True)
    async def power_api(self, base: float, exponent: float):
        """å¹‚è¿ç®—"""
        result = base ** exponent
        self.calculation_history.append(f"{base} ^ {exponent} = {result}")
        return {
            "result": result,
            "operation": "power",
            "inputs": [base, exponent],
            "formula": f"{base} ^ {exponent} = {result}"
        }

    @class_api("/history")
    async def history_api(self, request_data, request):
        """è®¡ç®—å†å²"""
        return {
            "history": self.calculation_history[-10:],  # æœ€è¿‘10æ¡è®°å½•
            "total_calculations": len(self.calculation_history)
        }

    @class_api("/clear")
    async def clear_api(self, request_data, request):
        """æ¸…é™¤å†å²"""
        count = len(self.calculation_history)
        self.calculation_history.clear()
        return {
            "message": f"å·²æ¸…é™¤ {count} æ¡è®¡ç®—è®°å½•",
            "cleared_count": count
        }

    @class_message_handler("text")
    async def handle_text_message(self, content: str, sender_id: str = None):
        """å¤„ç†æ–‡æœ¬æ¶ˆæ¯è¿›è¡Œè®¡ç®—"""
        content = content.strip()

        try:
            # ç®€å•çš„æ•°å­¦è¡¨è¾¾å¼è§£æ
            if '+' in content:
                parts = content.split('+')
                if len(parts) == 2:
                    a, b = float(parts[0].strip()), float(parts[1].strip())
                    result = a + b
                    self.calculation_history.append(f"{a} + {b} = {result}")
                    return {"reply": f"è®¡ç®—ç»“æœ: {a} + {b} = {result}"}

            elif '-' in content:
                parts = content.split('-')
                if len(parts) == 2:
                    a, b = float(parts[0].strip()), float(parts[1].strip())
                    result = a - b
                    self.calculation_history.append(f"{a} - {b} = {result}")
                    return {"reply": f"è®¡ç®—ç»“æœ: {a} - {b} = {result}"}

            elif '*' in content or 'Ã—' in content:
                separator = '*' if '*' in content else 'Ã—'
                parts = content.split(separator)
                if len(parts) == 2:
                    a, b = float(parts[0].strip()), float(parts[1].strip())
                    result = a * b
                    self.calculation_history.append(f"{a} Ã— {b} = {result}")
                    return {"reply": f"è®¡ç®—ç»“æœ: {a} Ã— {b} = {result}"}

            elif '/' in content or 'Ã·' in content:
                separator = '/' if '/' in content else 'Ã·'
                parts = content.split(separator)
                if len(parts) == 2:
                    a, b = float(parts[0].strip()), float(parts[1].strip())
                    if b == 0:
                        return {"reply": "é”™è¯¯: é™¤æ•°ä¸èƒ½ä¸ºé›¶"}
                    result = a / b
                    self.calculation_history.append(f"{a} Ã· {b} = {result}")
                    return {"reply": f"è®¡ç®—ç»“æœ: {a} Ã· {b} = {result}"}

            # å¦‚æœæ— æ³•è§£æï¼Œè¿”å›å¸®åŠ©ä¿¡æ¯
            return {
                "reply": f"æ— æ³•è§£æè¡¨è¾¾å¼: {content}\n"
                         "æ”¯æŒçš„æ ¼å¼:\n"
                         "â€¢ åŠ æ³•: 5 + 3\n"
                         "â€¢ å‡æ³•: 10 - 4\n"
                         "â€¢ ä¹˜æ³•: 6 * 7 æˆ– 6 Ã— 7\n"
                         "â€¢ é™¤æ³•: 15 / 3 æˆ– 15 Ã· 3"
            }

        except ValueError:
            return {"reply": f"æ•°å­—æ ¼å¼é”™è¯¯: {content}"}
        except Exception as e:
            return {"reply": f"è®¡ç®—é”™è¯¯: {str(e)}"}


async def main():
    # åˆ›å»ºAgentå®ä¾‹
    agent = CalculatorAgent()
    logger.info(f"âœ… Agent '{agent.agent.name}' åˆ›å»ºæˆåŠŸ!")

    # å¯åŠ¨æœåŠ¡å™¨
    server = ANP_Server()
    logger.info("ğŸš€ å¯åŠ¨è®¡ç®—å™¨æœåŠ¡å™¨...")
    server.start_server()

    logger.info("ğŸ”¥ è®¡ç®—å™¨æœåŠ¡è¿è¡Œä¸­ï¼ŒæŒ‰Ctrl+Cåœæ­¢")
    logger.info("ğŸ“Š å¯ç”¨çš„API:")
    logger.info("  - POST /add - åŠ æ³•")
    logger.info("  - POST /subtract - å‡æ³•")
    logger.info("  - POST /multiply - ä¹˜æ³•")
    logger.info("  - POST /divide - é™¤æ³•")
    logger.info("  - POST /power - å¹‚è¿ç®—")
    logger.info("  - POST /history - è®¡ç®—å†å²")
    logger.info("  - POST /clear - æ¸…é™¤å†å²")

    try:
        while True:
            await asyncio.sleep(1)
    except KeyboardInterrupt:
        logger.info("ğŸ‘‹ è®¡ç®—å™¨æœåŠ¡åœæ­¢")


if __name__ == "__main__":
    asyncio.run(main())
```

### æµ‹è¯•è®¡ç®—å™¨åŠŸèƒ½

```bash
# 1. åŠ æ³•æµ‹è¯•
curl -X POST http://localhost:9527/agent/api/did:wba:localhost%3A9527:wba:user:27c0b1d11180f973/add \
  -H "Content-Type: application/json" \
  -d '{"params": {"a": 15, "b": 25}}'

# å“åº”: {"result": 40, "operation": "addition", "inputs": [15, 25], "formula": "15 + 25 = 40"}

# 2. é™¤æ³•æµ‹è¯•
curl -X POST http://localhost:9527/agent/api/did:wba:localhost%3A9527:wba:user:27c0b1d11180f973/divide \
  -H "Content-Type: application/json" \
  -d '{"params": {"a": 100, "b": 4}}'

# 3. å¹‚è¿ç®—æµ‹è¯•
curl -X POST http://localhost:9527/agent/api/did:wba:localhost%3A9527:wba:user:27c0b1d11180f973/power \
  -H "Content-Type: application/json" \
  -d '{"params": {"base": 2, "exponent": 8}}'

# 4. æŸ¥çœ‹è®¡ç®—å†å²
curl -X POST http://localhost:9527/agent/api/did:wba:localhost%3A9527:wba:user:27c0b1d11180f973/history

# 5. å‘é€æ–‡æœ¬æ¶ˆæ¯è¿›è¡Œè®¡ç®—
curl -X POST http://localhost:9527/agent/message/did:wba:localhost%3A9527:wba:user:27c0b1d11180f973 \
  -H "Content-Type: application/json" \
  -d '{
    "req_did": "did:wba:localhost%3A9527:wba:user:sender",
    "content": "12 + 8",
    "message_type": "text"
  }'
```

---

## ğŸ“‹ ç¤ºä¾‹3: Agenté—´é€šä¿¡

### åˆ›å»ºä¸¤ä¸ªç›¸äº’é€šä¿¡çš„Agent

#### ä¸»æ§Agent

```python
# master_agent.py
import asyncio
from anp_runtime.agent_decorator import agent_class, class_api
from anp_runtime.anp_service.agent_api_call import agent_api_call_post
from anp_runtime.anp_service.agent_message_p2p import agent_msg_post


@agent_class(
    name="ä¸»æ§Agent",
    description="åè°ƒå…¶ä»–Agentçš„ä¸»æ§åˆ¶å™¨",
    did="did:wba:localhost%3A9527:wba:user:e0959abab6fc3c3d",
    shared=False
)
class MasterAgent:
    @class_api("/calculate", auto_wrap=True)
    async def calculate_api(self, expression: str):
        """é€šè¿‡è®¡ç®—å™¨Agentè¿›è¡Œè®¡ç®—"""
        try:
            # è§£æè¡¨è¾¾å¼
            if '+' in expression:
                parts = expression.split('+')
                a, b = float(parts[0].strip()), float(parts[1].strip())

                # è°ƒç”¨è®¡ç®—å™¨Agentçš„åŠ æ³•API
                result = await agent_api_call_post(
                    caller_agent=self.agent.anp_user_did,
                    target_agent="did:wba:localhost%3A9527:wba:user:27c0b1d11180f973",
                    api_path="/add",
                    params={"a": a, "b": b}
                )

                return {
                    "expression": expression,
                    "result": result,
                    "processed_by": "è®¡ç®—å™¨Agent"
                }

            else:
                return {"error": "ç›®å‰åªæ”¯æŒåŠ æ³•è¿ç®—"}

        except Exception as e:
            return {"error": f"è®¡ç®—å¤±è´¥: {str(e)}"}

    @class_api("/send_greeting", auto_wrap=True)
    async def send_greeting_api(self, target_agent: str, message: str):
        """å‘å…¶ä»–Agentå‘é€é—®å€™æ¶ˆæ¯"""
        try:
            result = await agent_msg_post(
                caller_agent=self.agent.anp_user_did,
                target_agent=target_agent,
                content=message,
                message_type="text"
            )

            return {
                "message_sent": True,
                "target": target_agent,
                "content": message,
                "response": result
            }

        except Exception as e:
            return {"error": f"æ¶ˆæ¯å‘é€å¤±è´¥: {str(e)}"}

    @class_api("/batch_calculate", auto_wrap=True)
    async def batch_calculate_api(self, expressions: list):
        """æ‰¹é‡è®¡ç®—å¤šä¸ªè¡¨è¾¾å¼"""
        results = []

        for expr in expressions:
            try:
                if '+' in expr:
                    parts = expr.split('+')
                    a, b = float(parts[0].strip()), float(parts[1].strip())

                    result = await agent_api_call_post(
                        caller_agent=self.agent.anp_user_did,
                        target_agent="did:wba:localhost%3A9527:wba:user:27c0b1d11180f973",
                        api_path="/add",
                        params={"a": a, "b": b}
                    )

                    results.append({
                        "expression": expr,
                        "result": result["result"],
                        "success": True
                    })
                else:
                    results.append({
                        "expression": expr,
                        "error": "ä¸æ”¯æŒçš„è¿ç®—",
                        "success": False
                    })

            except Exception as e:
                results.append({
                    "expression": expr,
                    "error": str(e),
                    "success": False
                })

        return {
            "total_expressions": len(expressions),
            "successful": len([r for r in results if r.get("success")]),
            "failed": len([r for r in results if not r.get("success")]),
            "results": results
        }
```

#### å·¥ä½œAgent

```python
# worker_agent.py
from anp_runtime.agent_decorator import agent_class, class_api, class_message_handler


@agent_class(
    name="å·¥ä½œAgent",
    description="æ‰§è¡Œå…·ä½“ä»»åŠ¡çš„å·¥ä½œAgent",
    did="did:wba:localhost%3A9527:wba:user:5fea49e183c6c211",
    shared=False
)
class WorkerAgent:
    def __init__(self):
        self.task_count = 0
        self.messages_received = []

    @class_api("/process_task", auto_wrap=True)
    async def process_task_api(self, task_type: str, data: dict):
        """å¤„ç†ä»»åŠ¡"""
        self.task_count += 1

        if task_type == "data_analysis":
            # æ¨¡æ‹Ÿæ•°æ®åˆ†æ
            numbers = data.get("numbers", [])
            if numbers:
                result = {
                    "task_id": self.task_count,
                    "task_type": task_type,
                    "analysis": {
                        "count": len(numbers),
                        "sum": sum(numbers),
                        "average": sum(numbers) / len(numbers),
                        "max": max(numbers),
                        "min": min(numbers)
                    }
                }
            else:
                result = {"error": "æ²¡æœ‰æä¾›æ•°æ®"}

        elif task_type == "text_processing":
            # æ¨¡æ‹Ÿæ–‡æœ¬å¤„ç†
            text = data.get("text", "")
            result = {
                "task_id": self.task_count,
                "task_type": task_type,
                "processing": {
                    "length": len(text),
                    "words": len(text.split()),
                    "uppercase": text.upper(),
                    "lowercase": text.lower()
                }
            }

        else:
            result = {"error": f"ä¸æ”¯æŒçš„ä»»åŠ¡ç±»å‹: {task_type}"}

        return result

    @class_api("/status")
    async def status_api(self, request_data, request):
        """è·å–å·¥ä½œçŠ¶æ€"""
        return {
            "agent_name": "å·¥ä½œAgent",
            "tasks_completed": self.task_count,
            "messages_received": len(self.messages_received),
            "status": "è¿è¡Œä¸­"
        }

    @class_message_handler("text")
    async def handle_text_message(self, content: str, sender_id: str = None):
        """å¤„ç†æ–‡æœ¬æ¶ˆæ¯"""
        self.messages_received.append({
            "content": content,
            "sender": sender_id,
            "timestamp": "2024-01-15"
        })

        return {
            "reply": f"å·¥ä½œAgentæ”¶åˆ°æ¶ˆæ¯: {content}",
            "message_count": len(self.messages_received),
            "sender": sender_id
        }
```

### å®Œæ•´çš„é€šä¿¡ç¤ºä¾‹

```python
# communication_demo.py
import asyncio
import logging
from anp_foundation.config import UnifiedConfig, set_global_config
from anp_foundation.utils.log_base import setup_logging
from anp_server.baseline.anp_server_baseline import ANP_Server

# å¯¼å…¥Agentç±»
from master_agent import MasterAgent
from worker_agent import WorkerAgent
from calculator_agent import CalculatorAgent


async def main():
    # é…ç½®åˆå§‹åŒ–
    config = UnifiedConfig(config_file='unified_config_framework_demo.yaml')
    set_global_config(config)
    setup_logging()
    logger = logging.getLogger(__name__)

    # åˆ›å»ºæ‰€æœ‰Agent
    master = MasterAgent()
    worker = WorkerAgent()
    calculator = CalculatorAgent()

    logger.info("âœ… æ‰€æœ‰Agentåˆ›å»ºæˆåŠŸ!")
    logger.info(f"  - ä¸»æ§Agent: {master.agent.name}")
    logger.info(f"  - å·¥ä½œAgent: {worker.agent.name}")
    logger.info(f"  - è®¡ç®—å™¨Agent: {calculator.agent.name}")

    # å¯åŠ¨æœåŠ¡å™¨
    server = ANP_Server()
    logger.info("ğŸš€ å¯åŠ¨é€šä¿¡æ¼”ç¤ºæœåŠ¡å™¨...")
    server.start_server()

    logger.info("ğŸ”¥ Agenté€šä¿¡ç³»ç»Ÿè¿è¡Œä¸­")
    logger.info("ğŸ“Š æµ‹è¯•å‘½ä»¤:")
    logger.info("  1. ä¸»æ§Agentè®¡ç®—: POST /calculate")
    logger.info("  2. ä¸»æ§Agentå‘é€æ¶ˆæ¯: POST /send_greeting")
    logger.info("  3. ä¸»æ§Agentæ‰¹é‡è®¡ç®—: POST /batch_calculate")
    logger.info("  4. å·¥ä½œAgentå¤„ç†ä»»åŠ¡: POST /process_task")

    try:
        while True:
            await asyncio.sleep(1)
    except KeyboardInterrupt:
        logger.info("ğŸ‘‹ é€šä¿¡æ¼”ç¤ºç³»ç»Ÿåœæ­¢")


if __name__ == "__main__":
    asyncio.run(main())
```

### æµ‹è¯•Agenté—´é€šä¿¡

```bash
# 1. ä¸»æ§Agenté€šè¿‡è®¡ç®—å™¨Agentè¿›è¡Œè®¡ç®—
curl -X POST http://localhost:9527/agent/api/did:wba:localhost%3A9527:wba:user:e0959abab6fc3c3d/calculate \
  -H "Content-Type: application/json" \
  -d '{"params": {"expression": "25 + 35"}}'

# 2. ä¸»æ§Agentå‘å·¥ä½œAgentå‘é€æ¶ˆæ¯
curl -X POST http://localhost:9527/agent/api/did:wba:localhost%3A9527:wba:user:e0959abab6fc3c3d/send_greeting \
  -H "Content-Type: application/json" \
  -d '{
    "params": {
      "target_agent": "did:wba:localhost%3A9527:wba:user:5fea49e183c6c211",
      "message": "ä½ å¥½ï¼Œå·¥ä½œAgentï¼"
    }
  }'

# 3. æ‰¹é‡è®¡ç®—
curl -X POST http://localhost:9527/agent/api/did:wba:localhost%3A9527:wba:user:e0959abab6fc3c3d/batch_calculate \
  -H "Content-Type: application/json" \
  -d '{
    "params": {
      "expressions": ["10 + 20", "5 + 15", "100 + 200"]
    }
  }'

# 4. å·¥ä½œAgentå¤„ç†æ•°æ®åˆ†æä»»åŠ¡
curl -X POST http://localhost:9527/agent/api/did:wba:localhost%3A9527:wba:user:5fea49e183c6c211/process_task \
  -H "Content-Type: application/json" \
  -d '{
    "params": {
      "task_type": "data_analysis",
      "data": {"numbers": [1, 2, 3, 4, 5, 10, 20, 30]}
    }
  }'
```

---

## ğŸ“‹ ç¤ºä¾‹4: å…±äº«DIDæ¨¡å¼

### åˆ›å»ºå…±äº«DIDçš„å¤šä¸ªAgent

```python
# shared_did_demo.py
import asyncio
from anp_runtime.agent_decorator import agent_class, class_api, class_message_handler


# ä¸»Agent - å¤„ç†æ¶ˆæ¯
@agent_class(
    name="å¤©æ°”ä¸»æœåŠ¡",
    description="å¤©æ°”ä¿¡æ¯ä¸»æœåŠ¡",
    did="did:wba:localhost%3A9527:wba:user:5fea49e183c6c211",
    shared=True,
    prefix="/weather",
    primary_agent=True  # ä¸»Agentï¼Œå¯ä»¥å¤„ç†æ¶ˆæ¯
)
class WeatherMainAgent:
    @class_api("/current", auto_wrap=True)
    async def current_weather(self, city: str = "åŒ—äº¬"):
        """è·å–å½“å‰å¤©æ°”"""
        # æ¨¡æ‹Ÿå¤©æ°”æ•°æ®
        weather_data = {
            "åŒ—äº¬": {"temperature": "22Â°C", "condition": "æ™´å¤©", "humidity": "65%"},
            "ä¸Šæµ·": {"temperature": "25Â°C", "condition": "å¤šäº‘", "humidity": "70%"},
            "æ·±åœ³": {"temperature": "28Â°C", "condition": "å°é›¨", "humidity": "80%"}
        }

        return {
            "city": city,
            "current_weather": weather_data.get(city, {
                "temperature": "20Â°C",
                "condition": "æœªçŸ¥",
                "humidity": "60%"
            }),
            "service": "å¤©æ°”ä¸»æœåŠ¡"
        }

    @class_message_handler("text")
    async def handle_weather_message(self, content: str, sender_id: str = None):
        """å¤„ç†å¤©æ°”ç›¸å…³æ¶ˆæ¯"""
        if "å¤©æ°”" in content:
            return {"reply": f"å¤©æ°”æœåŠ¡æ”¶åˆ°æŸ¥è¯¢: {content}ã€‚è¯·ä½¿ç”¨APIè·å–è¯¦ç»†ä¿¡æ¯ã€‚"}
        return {"reply": f"å¤©æ°”ä¸»æœåŠ¡æ”¶åˆ°: {content}"}


# è¾…åŠ©Agent 1 - å¤©æ°”é¢„æŠ¥
@agent_class(
    name="å¤©æ°”é¢„æŠ¥æœåŠ¡",
    description="å¤©æ°”é¢„æŠ¥è¾…åŠ©æœåŠ¡",
    did="did:wba:localhost%3A9527:wba:user:5fea49e183c6c211",  # ç›¸åŒDID
    shared=True,
    prefix="/forecast",
    primary_agent=False  # è¾…åŠ©Agentï¼Œä¸å¤„ç†æ¶ˆæ¯
)
class WeatherForecastAgent:
    @class_api("/daily", auto_wrap=True)
    async def daily_forecast(self, city: str = "åŒ—äº¬", days: int = 7):
        """è·å–æ¯æ—¥é¢„æŠ¥"""
        forecast = []
        conditions = ["æ™´å¤©", "å¤šäº‘", "å°é›¨", "é˜´å¤©"]

        for i in range(days):
            forecast.append({
                "date": f"2024-01-{15 + i:02d}",
                "high": f"{20 + i}Â°C",
                "low": f"{10 + i}Â°C",
                "condition": conditions[i % len(conditions)]
            })

        return {
            "city": city,
            "forecast_days": days,
            "forecast": forecast,
            "service": "å¤©æ°”é¢„æŠ¥æœåŠ¡"
        }

    @class_api("/weekly", auto_wrap=True)
    async def weekly_forecast(self, city: str = "åŒ—äº¬"):
        """è·å–å‘¨é¢„æŠ¥"""
        return await self.daily_forecast(city, 7)


# è¾…åŠ©Agent 2 - å¤©æ°”å†å²
@agent_class(
    name="å¤©æ°”å†å²æœåŠ¡",
    description="å¤©æ°”å†å²æ•°æ®æœåŠ¡",
    did="did:wba:localhost%3A9527:wba:user:5fea49e183c6c211",  # ç›¸åŒDID
    shared=True,
    prefix="/history",
    primary_agent=False  # è¾…åŠ©Agentï¼Œä¸å¤„ç†æ¶ˆæ¯
)
class WeatherHistoryAgent:
    @class_api("/monthly", auto_wrap=True)
    async def monthly_history(self, city: str = "åŒ—äº¬", year: int = 2023, month: int = 12):
        """è·å–æœˆåº¦å†å²å¤©æ°”"""
        # æ¨¡æ‹Ÿå†å²æ•°æ®
        history = []
        for day in range(1, 31):
            history.append({
                "date": f"{year}-{month:02d}-{day:02d}",
                "high": f"{15 + (day % 10)}Â°C",
                "low": f"{5 + (day % 8)}Â°C",
                "condition": ["æ™´å¤©", "å¤šäº‘", "å°é›¨"][day % 3]
            })

        return {
            "city": city,
            "year": year,
            "month": month,
            "history": history,
            "service": "å¤©æ°”å†å²æœåŠ¡"
        }

    @class_api("/yearly", auto_wrap=True)
    async def yearly_summary(self, city: str = "åŒ—äº¬", year: int = 2023):
        """è·å–å¹´åº¦å¤©æ°”æ€»ç»“"""
        return {
            "city": city,
            "year": year,
            "summary": {
                "average_temperature": "18Â°C",
                "total_rainy_days": 120,
                "total_sunny_days": 200,
                "total_cloudy_days": 45
            },
            "service": "å¤©æ°”å†å²æœåŠ¡"
        }


async def main():
    # é…ç½®å’Œå¯åŠ¨
    from anp_foundation.config import UnifiedConfig, set_global_config
    from anp_foundation.utils.log_base import setup_logging
    from anp_server.baseline.anp_server_baseline import ANP_Server

    config = UnifiedConfig(config_file='unified_config_framework_demo.yaml')
    set_global_config(config)
    setup_logging()
    logger = logging.getLogger(__name__)

    # åˆ›å»ºæ‰€æœ‰Agent
    weather_main = WeatherMainAgent()
    weather_forecast = WeatherForecastAgent()
    weather_history = WeatherHistoryAgent()

    logger.info("âœ… å…±äº«DIDå¤©æ°”æœåŠ¡ç³»ç»Ÿåˆ›å»ºæˆåŠŸ!")
    logger.info(f"  - ä¸»æœåŠ¡: {weather_main.agent.name} (prefix: /weather)")
    logger.info(f"  - é¢„æŠ¥æœåŠ¡: {weather_forecast.agent.name} (prefix: /forecast)")
    logger.info(f"  - å†å²æœåŠ¡: {weather_history.agent.name} (prefix: /history)")
    logger.info(f"  - å…±äº«DID: {weather_main.agent.anp_user_did}")

    # å¯åŠ¨æœåŠ¡å™¨
    server = ANP_Server()
    logger.info("ğŸš€ å¯åŠ¨å…±äº«DIDæ¼”ç¤ºæœåŠ¡å™¨...")
    server.start_server()

    logger.info("ğŸ”¥ å…±äº«DIDå¤©æ°”æœåŠ¡è¿è¡Œä¸­")
    logger.info("ğŸ“Š å¯ç”¨çš„API:")
    logger.info("  - POST /weather/current - å½“å‰å¤©æ°”")
    logger.info("  - POST /forecast/daily - æ¯æ—¥é¢„æŠ¥")
    logger.info("  - POST /forecast/weekly - å‘¨é¢„æŠ¥")
    logger.info("  - POST /history/monthly - æœˆåº¦å†å²")
    logger.info("  - POST /history/yearly - å¹´åº¦æ€»ç»“")

    try:
        while True:
            await asyncio.sleep(1)
    except KeyboardInterrupt:
        logger.info("ğŸ‘‹ å…±äº«DIDå¤©æ°”æœåŠ¡åœæ­¢")


if __name__ == "__main__":
    asyncio.run(main())
```

### æµ‹è¯•å…±äº«DIDæœåŠ¡

```bash
# 1. è°ƒç”¨å¤©æ°”å½“å‰ä¿¡æ¯ (ä¸»æœåŠ¡)
curl -X POST http://localhost:9527/agent/api/did:wba:localhost%3A9527:wba:user:5fea49e183c6c211/weather/current \
  -H "Content-Type: application/json" \
  -d '{"params": {"city": "ä¸Šæµ·"}}'

# 2. è°ƒç”¨å¤©æ°”é¢„æŠ¥ (é¢„æŠ¥æœåŠ¡)
curl -X POST http://localhost:9527/agent/api/did:wba:localhost%3A9527:wba:user:5fea49e183c6c211/forecast/daily \
  -H "Content-Type: application/json" \
  -d '{"params": {"city": "æ·±åœ³", "days": 5}}'

# 3. è°ƒç”¨å†å²å¤©æ°” (å†å²æœåŠ¡)
curl -X POST http://localhost:9527/agent/api/did:wba:localhost%3A9527:wba:user:5fea49e183c6c211/history/monthly \
  -H "Content-Type: application/json" \
  -d '{"params": {"city": "åŒ—äº¬", "year": 2023, "month": 11}}'

# 4. å‘é€æ¶ˆæ¯ (åªæœ‰ä¸»Agentèƒ½å¤„ç†)
curl -X POST http://localhost:9527/agent/message/did:wba:localhost%3A9527:wba:user:5fea49e183c6c211 \
  -H "Content-Type: application/json" \
  -d '{
    "req_did": "did:wba:localhost%3A9527:wba:user:sender",
    "content": "ä»Šå¤©åŒ—äº¬å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ",
    "message_type": "text"
  }'
```

---

## ğŸ“‹ ç¤ºä¾‹5: è‡ªå®šä¹‰Memoryç®¡ç†

### åˆ›å»ºæ”¯æŒè®°å¿†åŠŸèƒ½çš„æ™ºèƒ½Agent

```python
# memory_agent.py
import asyncio
import logging
from datetime import datetime
from typing import Optional
from anp_runtime.agent_decorator import agent_class, class_api, class_message_handler
from anp_runtime.local_service.memory.custom_memory_manager import get_custom_memory_manager
from anp_runtime.local_service.memory.custom_memory_models import TemplateFactory
from anp_foundation.config import UnifiedConfig, set_global_config
from anp_foundation.utils.log_base import setup_logging
from anp_server.baseline.anp_server_baseline import ANP_Server

# é…ç½®åˆå§‹åŒ–
config = UnifiedConfig(config_file='unified_config_framework_demo.yaml')
set_global_config(config)
setup_logging()
logger = logging.getLogger(__name__)


@agent_class(
    name="æ™ºèƒ½è®°å¿†åŠ©æ‰‹",
    description="æ”¯æŒè‡ªå®šä¹‰è®°å¿†ç®¡ç†çš„æ™ºèƒ½åŠ©æ‰‹",
    did="did:wba:localhost%3A9527:wba:user:27c0b1d11180f973",
    shared=False
)
class MemoryAgent:
    def __init__(self):
        self.memory_manager = get_custom_memory_manager()
        self.setup_templates()
    
    def setup_templates(self):
        """è®¾ç½®è®°å¿†æ¨¡æ¿"""
        # æ³¨å†Œé¢„å®šä¹‰æ¨¡æ¿
        factory = TemplateFactory()
        
        # å¼‚æ­¥åˆå§‹åŒ–æ¨¡æ¿
        asyncio.create_task(self._register_templates(factory))
    
    async def _register_templates(self, factory):
        """æ³¨å†Œæ¨¡æ¿åˆ°ç®¡ç†å™¨"""
        try:
            # ä»»åŠ¡æ¨¡æ¿
            task_template = factory.get_task_template()
            await self.memory_manager.register_template(task_template)
            
            # ç¬”è®°æ¨¡æ¿
            note_template = factory.get_note_template()
            await self.memory_manager.register_template(note_template)
            
            # è”ç³»äººæ¨¡æ¿
            contact_template = factory.get_contact_template()
            await self.memory_manager.register_template(contact_template)
            
            logger.info("âœ… è®°å¿†æ¨¡æ¿æ³¨å†Œå®Œæˆ")
        except Exception as e:
            logger.error(f"æ¨¡æ¿æ³¨å†Œå¤±è´¥: {e}")

    @class_api("/create_note", auto_wrap=True)
    async def create_note_api(self, title: str, content: str,
                             category: str = "general", tags: str = ""):
        """åˆ›å»ºç¬”è®°"""
        try:
            note_id = await self.memory_manager.create_custom_memory(
                template_name="note_template",
                content={
                    "title": title,
                    "content": content,
                    "category": category,
                    "tags": tags.split(",") if tags else [],
                    "created_at": datetime.now().isoformat()
                }
            )
            
            return {
                "success": True,
                "note_id": note_id,
                "message": f"ç¬”è®° '{title}' åˆ›å»ºæˆåŠŸ"
            }
        except Exception as e:
            return {"success": False, "error": str(e)}

    @class_api("/create_task", auto_wrap=True)
    async def create_task_api(self, title: str, description: str = "",
                             priority: str = "medium", project: str = "default"):
        """åˆ›å»ºä»»åŠ¡"""
        try:
            task_id = await self.memory_manager.create_custom_memory(
                template_name="task_template",
                session_id=project,
                content={
                    "title": title,
                    "description": description,
                    "priority": priority,
                    "status": "todo",
                    "created_at": datetime.now().isoformat()
                }
            )
            
            return {
                "success": True,
                "task_id": task_id,
                "message": f"ä»»åŠ¡ '{title}' åˆ›å»ºæˆåŠŸ",
                "project": project
            }
        except Exception as e:
            return {"success": False, "error": str(e)}

    @class_api("/search_notes", auto_wrap=True)
    async def search_notes_api(self, keyword: Optional[str] = None,
                              category: Optional[str] = None, limit: int = 10):
        """æœç´¢ç¬”è®°"""
        try:
            # æœç´¢æ‰€æœ‰ç¬”è®°
            notes = await self.memory_manager.search_custom_memories(
                template_name="note_template",
                limit=limit
            )
            
            # æŒ‰æ¡ä»¶è¿‡æ»¤
            filtered_notes = []
            for note in notes:
                content_data = note.content
                
                # å…³é”®è¯è¿‡æ»¤
                if keyword:
                    if (keyword.lower() not in content_data.get("title", "").lower() and
                        keyword.lower() not in content_data.get("content", "").lower()):
                        continue
                
                # åˆ†ç±»è¿‡æ»¤
                if category and content_data.get("category") != category:
                    continue
                
                filtered_notes.append({
                    "id": note.id,
                    "title": content_data.get("title"),
                    "content": content_data.get("content")[:100] + "...",
                    "category": content_data.get("category"),
                    "tags": content_data.get("tags", []),
                    "created_at": content_data.get("created_at")
                })
            
            return {
                "success": True,
                "total_found": len(filtered_notes),
                "notes": filtered_notes,
                "search_params": {
                    "keyword": keyword,
                    "category": category,
                    "limit": limit
                }
            }
        except Exception as e:
            return {"success": False, "error": str(e)}

    @class_api("/list_tasks", auto_wrap=True)
    async def list_tasks_api(self, project: str = "default",
                            status: Optional[str] = None):
        """åˆ—å‡ºé¡¹ç›®ä»»åŠ¡"""
        try:
            tasks = await self.memory_manager.search_custom_memories(
                template_name="task_template",
                session_id=project
            )
            
            # æŒ‰çŠ¶æ€è¿‡æ»¤
            if status:
                tasks = [t for t in tasks if t.content.get("status") == status]
            
            task_list = []
            for task in tasks:
                content_data = task.content
                task_list.append({
                    "id": task.id,
                    "title": content_data.get("title"),
                    "description": content_data.get("description"),
                    "priority": content_data.get("priority"),
                    "status": content_data.get("status"),
                    "created_at": content_data.get("created_at")
                })
            
            return {
                "success": True,
                "project": project,
                "total_tasks": len(task_list),
                "tasks": task_list
            }
        except Exception as e:
            return {"success": False, "error": str(e)}

    @class_api("/update_task", auto_wrap=True)
    async def update_task_api(self, task_id: str, status: Optional[str] = None,
                             priority: Optional[str] = None):
        """æ›´æ–°ä»»åŠ¡"""
        try:
            update_data = {}
            if status:
                update_data["status"] = status
            if priority:
                update_data["priority"] = priority
            
            if not update_data:
                return {"success": False, "error": "æ²¡æœ‰æä¾›è¦æ›´æ–°çš„å­—æ®µ"}
            
            await self.memory_manager.update_custom_memory(
                task_id, content=update_data
            )
            
            return {
                "success": True,
                "message": "ä»»åŠ¡æ›´æ–°æˆåŠŸ",
                "updated_fields": update_data
            }
        except Exception as e:
            return {"success": False, "error": str(e)}

    @class_api("/memory_stats")
    async def memory_stats_api(self, request_data, request):
        """è·å–è®°å¿†ç»Ÿè®¡ä¿¡æ¯"""
        try:
            stats = {
                "notes": 0,
                "tasks": 0,
                "contacts": 0,
                "templates": []
            }
            
            # ç»Ÿè®¡ç¬”è®°
            notes = await self.memory_manager.search_custom_memories(
                template_name="note_template"
            )
            stats["notes"] = len(notes)
            
            # ç»Ÿè®¡ä»»åŠ¡
            tasks = await self.memory_manager.search_custom_memories(
                template_name="task_template"
            )
            stats["tasks"] = len(tasks)
            
            # ç»Ÿè®¡è”ç³»äºº
            contacts = await self.memory_manager.search_custom_memories(
                template_name="contact_template"
            )
            stats["contacts"] = len(contacts)
            
            # è·å–æ¨¡æ¿åˆ—è¡¨
            templates = await self.memory_manager.list_templates()
            stats["templates"] = list(templates.keys())
            
            return {
                "success": True,
                "statistics": stats
            }
        except Exception as e:
            return {"success": False, "error": str(e)}

    @class_message_handler("text")
    async def handle_text_message(self, content: str, sender_id: str = None):
        """å¤„ç†æ–‡æœ¬æ¶ˆæ¯å¹¶è‡ªåŠ¨åˆ›å»ºè®°å¿†"""
        try:
            # ç®€å•çš„æ„å›¾è¯†åˆ«
            content_lower = content.lower()
            
            if "è®°ä½" in content or "è®°å½•" in content:
                # åˆ›å»ºç¬”è®°
                note_id = await self.memory_manager.create_custom_memory(
                    template_name="note_template",
                    content={
                        "title": f"æ¶ˆæ¯è®°å½• - {datetime.now().strftime('%Y%m%d %H:%M')}",
                        "content": content,
                        "category": "message",
                        "created_at": datetime.now().isoformat()
                    }
                )
                
                return {
                    "reply": f"å·²è®°å½•æ‚¨çš„æ¶ˆæ¯: {content[:50]}{'...' if len(content) > 50 else ''}",
                    "note_id": note_id
                }
            
            elif "ä»»åŠ¡" in content or "å¾…åŠ" in content:
                # å°è¯•æå–ä»»åŠ¡ä¿¡æ¯
                task_title = content.replace("ä»»åŠ¡:", "").replace("å¾…åŠ:", "").strip()
                
                task_id = await self.memory_manager.create_custom_memory(
                    template_name="task_template",
                    content={
                        "title": task_title,
                        "status": "todo",
                        "priority": "medium",
                        "created_at": datetime.now().isoformat()
                    }
                )
                
                return {
                    "reply": f"å·²åˆ›å»ºä»»åŠ¡: {task_title}",
                    "task_id": task_id
                }
            
            else:
                return {
                    "reply": f"æ”¶åˆ°æ¶ˆæ¯: {content}ã€‚æ‚¨å¯ä»¥è¯´'è®°ä½...'æ¥åˆ›å»ºç¬”è®°ï¼Œæˆ–'ä»»åŠ¡:...'æ¥åˆ›å»ºä»»åŠ¡ã€‚"
                }
        
        except Exception as e:
            return {"reply": f"å¤„ç†æ¶ˆæ¯æ—¶å‡ºé”™: {str(e)}"}


async def main():
    # åˆ›å»ºAgentå®ä¾‹
    agent = MemoryAgent()
    logger.info(f"âœ… Agent '{agent.agent.name}' åˆ›å»ºæˆåŠŸ!")

    # å¯åŠ¨æœåŠ¡å™¨
    server = ANP_Server()
    logger.info("ğŸš€ å¯åŠ¨è®°å¿†åŠ©æ‰‹æœåŠ¡å™¨...")
    server.start_server()

    logger.info("ğŸ”¥ è®°å¿†åŠ©æ‰‹æœåŠ¡è¿è¡Œä¸­")
    logger.info("ğŸ“Š å¯ç”¨çš„API:")
    logger.info("  - POST /create_note - åˆ›å»ºç¬”è®°")
    logger.info("  - POST /create_task - åˆ›å»ºä»»åŠ¡")
    logger.info("  - POST /search_notes - æœç´¢ç¬”è®°")
    logger.info("  - POST /list_tasks - åˆ—å‡ºä»»åŠ¡")
    logger.info("  - POST /update_task - æ›´æ–°ä»»åŠ¡")
    logger.info("  - POST /memory_stats - è®°å¿†ç»Ÿè®¡")
    logger.info("ğŸ’¬ å‘é€æ¶ˆæ¯:")
    logger.info("  - 'è®°ä½ [å†…å®¹]' - è‡ªåŠ¨åˆ›å»ºç¬”è®°")
    logger.info("  - 'ä»»åŠ¡: [ä»»åŠ¡æè¿°]' - è‡ªåŠ¨åˆ›å»ºä»»åŠ¡")

    try:
        while True:
            await asyncio.sleep(1)
    except KeyboardInterrupt:
        logger.info("ğŸ‘‹ è®°å¿†åŠ©æ‰‹æœåŠ¡åœæ­¢")


if __name__ == "__main__":
    asyncio.run(main())
```

### æµ‹è¯•è‡ªå®šä¹‰MemoryåŠŸèƒ½

```bash
# 1. åˆ›å»ºç¬”è®°
curl -X POST http://localhost:9527/agent/api/did:wba:localhost%3A9527:wba:user:27c0b1d11180f973/create_note \
  -H "Content-Type: application/json" \
  -d '{
    "params": {
      "title": "ANPå­¦ä¹ ç¬”è®°",
      "content": "ANP SDKæ˜¯ä¸€ä¸ªå¼ºå¤§çš„æ™ºèƒ½ä½“å¼€å‘æ¡†æ¶ï¼Œæ”¯æŒè‡ªå®šä¹‰Memoryç®¡ç†ã€‚",
      "category": "å­¦ä¹ ",
      "tags": "ANP,SDK,å¼€å‘"
    }
  }'

# å“åº”: {"success": true, "note_id": "note_12345", "message": "ç¬”è®° 'ANPå­¦ä¹ ç¬”è®°' åˆ›å»ºæˆåŠŸ"}

# 2. åˆ›å»ºä»»åŠ¡
curl -X POST http://localhost:9527/agent/api/did:wba:localhost%3A9527:wba:user:27c0b1d11180f973/create_task \
  -H "Content-Type: application/json" \
  -d '{
    "params": {
      "title": "å®ŒæˆMemoryæ–‡æ¡£",
      "description": "ç¼–å†™è‡ªå®šä¹‰Memoryç®¡ç†ç³»ç»Ÿçš„ä½¿ç”¨æ–‡æ¡£",
      "priority": "high",
      "project": "ANP_Documentation"
    }
  }'

# 3. æœç´¢ç¬”è®°
curl -X POST http://localhost:9527/agent/api/did:wba:localhost%3A9527:wba:user:27c0b1d11180f973/search_notes \
  -H "Content-Type: application/json" \
  -d '{
    "params": {
      "keyword": "ANP",
      "category": "å­¦ä¹ ",
      "limit": 5
    }
  }'

# 4. åˆ—å‡ºé¡¹ç›®ä»»åŠ¡
curl -X POST http://localhost:9527/agent/api/did:wba:localhost%3A9527:wba:user:27c0b1d11180f973/list_tasks \
  -H "Content-Type: application/json" \
  -d '{
    "params": {
      "project": "ANP_Documentation",
      "status": "todo"
    }
  }'

# 5. æ›´æ–°ä»»åŠ¡çŠ¶æ€
curl -X POST http://localhost:9527/agent/api/did:wba:localhost%3A9527:wba:user:27c0b1d11180f973/update_task \
  -H "Content-Type: application/json" \
  -d '{
    "params": {
      "task_id": "task_12345",
      "status": "in_progress",
      "priority": "urgent"
    }
  }'

# 6. è·å–è®°å¿†ç»Ÿè®¡
curl -X POST http://localhost:9527/agent/api/did:wba:localhost%3A9527:wba:user:27c0b1d11180f973/memory_stats

# 7. å‘é€æ™ºèƒ½æ¶ˆæ¯
curl -X POST http://localhost:9527/agent/message/did:wba:localhost%3A9527:wba:user:27c0b1d11180f973 \
  -H "Content-Type: application/json" \
  -d '{
    "req_did": "did:wba:localhost%3A9527:wba:user:sender",
    "content": "è®°ä½ä»Šå¤©å­¦ä¹ äº†ANP SDKçš„è‡ªå®šä¹‰MemoryåŠŸèƒ½",
    "message_type": "text"
  }'

# 8. åˆ›å»ºä»»åŠ¡æ¶ˆæ¯
curl -X POST http://localhost:9527/agent/message/did:wba:localhost%3A9527:wba:user:27c0b1d11180f973 \
  -H "Content-Type: application/json" \
  -d '{
    "req_did": "did:wba:localhost%3A9527:wba:user:sender",
    "content": "ä»»åŠ¡: æ˜å¤©å¼€ä¼šè®¨è®ºé¡¹ç›®è¿›åº¦",
    "message_type": "text"
  }'
```

### MCPå·¥å…·æ¥å£ç¤ºä¾‹

```python
# mcp_tools_demo.py
import asyncio
from anp_runtime.local_service.memory.custom_memory_mcp_tools import CustomMemoryMCPTools

async def mcp_demo():
    """æ¼”ç¤ºMCPå·¥å…·æ¥å£çš„ä½¿ç”¨"""
    tools = CustomMemoryMCPTools()
    
    print("ğŸ› ï¸  MCPå·¥å…·æ¥å£æ¼”ç¤º")
    
    # 1. åˆ›å»ºè®°å¿†
    print("\n1. åˆ›å»ºè®°å¿†...")
    create_result = await tools.create_custom_memory_tool(
        template_name="note_template",
        content={
            "title": "MCPå·¥å…·æµ‹è¯•",
            "content": "è¿™æ˜¯é€šè¿‡MCPå·¥å…·åˆ›å»ºçš„ç¬”è®°",
            "category": "test"
        }
    )
    print(f"åˆ›å»ºç»“æœ: {create_result}")
    
    # 2. æœç´¢è®°å¿†
    print("\n2. æœç´¢è®°å¿†...")
    search_result = await tools.search_custom_memories_tool(
        template_name="note_template"
    )
    print(f"æœç´¢ç»“æœ: {search_result}")
    
    # 3. æ‰¹é‡åˆ›å»º
    print("\n3. æ‰¹é‡åˆ›å»ºè®°å¿†...")
    batch_data = [
        {
            "template_name": "task_template",
            "content": {"title": "æ‰¹é‡ä»»åŠ¡1", "priority": "high"}
        },
        {
            "template_name": "task_template",
            "content": {"title": "æ‰¹é‡ä»»åŠ¡2", "priority": "medium"}
        }
    ]
    batch_result = await tools.batch_create_memories_tool(memories=batch_data)
    print(f"æ‰¹é‡åˆ›å»ºç»“æœ: {batch_result}")
    
    # 4. è·å–ç»Ÿè®¡ä¿¡æ¯
    print("\n4. è·å–ç»Ÿè®¡ä¿¡æ¯...")
    stats_result = await tools.get_memory_statistics_tool()
    print(f"ç»Ÿè®¡ä¿¡æ¯: {stats_result}")

if __name__ == "__main__":
    asyncio.run(mcp_demo())
```

---

## ğŸ‰ æ€»ç»“

é€šè¿‡è¿™äº›ç¤ºä¾‹ï¼Œä½ å·²ç»å­¦ä¼šäº†ï¼š

### âœ… æ ¸å¿ƒæŠ€èƒ½

1. **åˆ›å»ºåŸºç¡€Agent** - ä½¿ç”¨`@agent_class`è£…é¥°å™¨
2. **å®šä¹‰APIæ¥å£** - ä½¿ç”¨`@class_api`è£…é¥°å™¨
3. **å¤„ç†æ¶ˆæ¯** - ä½¿ç”¨`@class_message_handler`è£…é¥°å™¨
4. **Agenté—´é€šä¿¡** - APIè°ƒç”¨å’Œæ¶ˆæ¯ä¼ é€’
5. **å…±äº«DIDæ¨¡å¼** - å¤šAgentå…±äº«åŒä¸€èº«ä»½
6. **è‡ªå®šä¹‰Memoryç®¡ç†** - ä½¿ç”¨CustomMemoryManagerè¿›è¡Œè®°å¿†ç®¡ç†
7. **MCPå·¥å…·æ¥å£** - æ ‡å‡†åŒ–çš„Memoryæ“ä½œæ¥å£

### ğŸš€ ä¸‹ä¸€æ­¥

1. **é˜…è¯»å®Œæ•´æ–‡æ¡£** - [ANPåº”ç”¨å¼€å‘æŒ‡å—](ANPåº”ç”¨å¼€å‘æŒ‡å—.md)
2. **æŸ¥çœ‹æ¶æ„å›¾** - [ANPç³»ç»Ÿæ¶æ„å›¾](ANPç³»ç»Ÿæ¶æ„å›¾.md)
3. **ç ”ç©¶ç¤ºä¾‹ä»£ç ** - `examples/flow_anp_agent/`
4. **è‡ªå®šä¹‰Agent** - æ ¹æ®ä¸šåŠ¡éœ€æ±‚å¼€å‘

### ğŸ’¡ æœ€ä½³å®è·µæé†’

- ä½¿ç”¨æœ‰æ„ä¹‰çš„DIDå’ŒAgentåç§°
- ä¸ºAPIæ·»åŠ è¯¦ç»†çš„æ–‡æ¡£å­—ç¬¦ä¸²
- å®ç°é€‚å½“çš„é”™è¯¯å¤„ç†
- è®°å½•é‡è¦çš„æ“ä½œæ—¥å¿—
- æµ‹è¯•Agenté—´çš„é€šä¿¡åŠŸèƒ½

å¼€å§‹æ„å»ºä½ çš„ANPåº”ç”¨å§ï¼ğŸš€

---

*å¿«é€Ÿå…¥é—¨ç¤ºä¾‹æœ€åæ›´æ–°: 2024å¹´1æœˆ*
